/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package yt.downloader;


import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import java.io.File;
import java.util.*;

@SpringBootApplication
public class App {

    public static ConfigManager configManager;
    public static String webpage;
    public static String style;
    public static String js;

    public static String progressJS;

    public static Random random = new Random();

    // ID :  Video title
    public static HashMap<Long, String> titles = new HashMap<>();

    // ID :  Format name -> mp4 / mp3
    public static HashMap<Long, String> formats = new HashMap<>();

    public static HashMap<Long, String> links = new HashMap<>();


    // ID : IP Addr
    public static HashMap<Long, String> IDs = new HashMap<>();


    public static void main(String[] args) {
        try {
            configManager = new ConfigManager();
        } catch (Exception e) { e.printStackTrace(); }

        for (String path : List.of("web/index.html", "web/styles.css", "web/app.js", "web/progress.js")) {
            File file = new File(path);
            if (file.exists()) {
                try (Scanner myReader = new Scanner(file)) {
                    StringBuilder stringBuilder = new StringBuilder();
                    while (myReader.hasNextLine()) {
                        stringBuilder.append(myReader.nextLine()).append("\n");
                    }
                    myReader.close();
                    if (path.endsWith("app.js")) {
                        js = stringBuilder.toString();
                    } else if (path.endsWith("progress.js")) {
                        progressJS = stringBuilder.toString();
                    } else if (path.endsWith(".css")){
                        style = stringBuilder.toString();
                    } else {
                        webpage = stringBuilder.toString();
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                }
            } else {
                if (path.endsWith(".js")) {
                    js = "function updateDownloadProgress(percent) { document.getElementById(\"progress\").innerHTML = percent }";
                } else if (path.endsWith(".css")){
                    style = "body { background-image: url('background.jpg');background-repeat: no-repeat;background-attachment: fixed;background-size: cover; }";
                } else {
                    webpage = configManager.getIndexHtml();
                }
            }
        }

        //Executors.newScheduledThreadPool(1).scheduleAtFixedRate(() -> th.removeIf(t -> !t.isAlive()) ,
         //       0, 1, TimeUnit.MINUTES);

        SpringApplication app = new SpringApplication(App.class);
        app.setDefaultProperties(Collections.singletonMap("server.port", "25533"));
        app.run(args);

    }


    // background-image: url(\""+image_url+"\");background-repeat: no-repeat;background-position: left;padding-left: 250px;font-weight: bold;background-size: 100%;
}
